using Microsoft.AspNetCore.Http;
using Microsoft.AspNetCore.Mvc;
using Microsoft.Extensions.Logging;
using Monetaris.User.Services;
using Monetaris.User.Models;
using Monetaris.Shared.Models;

namespace Monetaris.User.Api;

/// <summary>
/// ü§ñ TEMPLATE for POST auth endpoints (Login, Register, Logout, RefreshToken)
/// AI: Copy this file and modify only the marked sections
/// </summary>
[ApiController]
[Route("api/auth")]
public class _TEMPLATE_Auth_Post : ControllerBase
{
    private readonly IAuthService _authService;
    private readonly ILogger<_TEMPLATE_Auth_Post> _logger;

    // ü§ñ AI: Constructor injection pattern - ALWAYS use this
    public _TEMPLATE_Auth_Post(IAuthService authService, ILogger<_TEMPLATE_Auth_Post> logger)
    {
        _authService = authService;
        _logger = logger;
    }

    /// <summary>
    /// ü§ñ AI: POST endpoints for authentication operations
    /// Examples: login, register, logout, refresh-token, change-password
    /// </summary>
    /// <param name="request">ü§ñ AI: Replace with appropriate request type (LoginRequest, RegisterRequest, etc.)</param>
    /// <returns>ü§ñ AI: Return AuthResponse for login/register/refresh, or NoContent for logout</returns>
    [HttpPost("template-route")]  // ü§ñ AI: Change route (e.g., "login", "register", "logout", "refresh")
    [ProducesResponseType(typeof(AuthResponse), StatusCodes.Status200OK)]  // ü§ñ AI: Use 200 for login/register/refresh
    // [ProducesResponseType(StatusCodes.Status204NoContent)]  // ü§ñ AI: Use 204 for logout (uncomment if needed)
    [ProducesResponseType(typeof(ProblemDetails), StatusCodes.Status400BadRequest)]
    public async Task<IActionResult> Handle([FromBody] LoginRequest request)  // ü§ñ AI: Replace request type
    {
        // ü§ñ AI: Update log message to describe the operation
        _logger.LogInformation("Template auth operation called");

        // ü§ñ AI: Call appropriate auth service method
        // Examples:
        // - var result = await _authService.LoginAsync(request);
        // - var result = await _authService.RegisterAsync(request);
        // - var result = await _authService.RefreshTokenAsync(request.RefreshToken);
        // - var result = await _authService.LogoutAsync(request.RefreshToken);
        var result = Result<AuthResponse>.Failure("Template not implemented");

        // ü§ñ AI: ALWAYS use Result<T> pattern - DO NOT change this
        if (!result.IsSuccess)
        {
            _logger.LogWarning("Template auth operation failed: {Error}", result.ErrorMessage);
            return BadRequest(new { error = result.ErrorMessage });
        }

        // ü§ñ AI: For logout (returns Result without data), use:
        // _logger.LogInformation("Logout successful");
        // return NoContent();

        // ü§ñ AI: For login/register/refresh (returns Result<AuthResponse>), use:
        _logger.LogInformation("Template auth operation successful");
        return Ok(result.Data);
    }
}

// ü§ñ AI: SECURITY CHECKLIST
// ‚ùå NEVER log passwords or tokens
// ‚úÖ Use generic error messages (don't reveal if email exists)
// ‚úÖ Add [Authorize] only if endpoint requires authentication (e.g., logout, change-password)
// ‚úÖ Use _logger.LogWarning for failed authentication attempts
// ‚úÖ Include user ID in logs for authenticated endpoints
